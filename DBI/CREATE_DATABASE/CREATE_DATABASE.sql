--Bước 1 : tạo database
CREATE DATABASE QL_CONGTY_SE1809
--TRUY CẬP VÀO DATABASE QL_CONGTY_SÉ809
USE QL_CONGTY_SE1809

--Bước 2 : tạo table 
CREATE TABLE NHANVIEN
(
	MANV DECIMAL(18,0) NOT NULL PRIMARY KEY,
	--Phần nguyên và phần thập phân 
	TENNV nvarchar(200),
	--Các datatype cho phép TV : char/nchar , kí tự dài nchar/nvachar
	DIACHI NVARCHAR(200),
	LUONG MONEY,
	GIOITINH CHAR(5),
	NGAYSINH DATE,
	MAPHG INT,
	MANGS DECIMAL(18,0),
	NGAYNC DATE
)
---INSERT DATA NHANVIEN
INSERT INTO NHANVIEN VALUES (30121050004, N'Mai Duy An', N'Long An', 30000, 'F', '1968-02-17', 1, 30121050037, '2000-01-01');
INSERT INTO NHANVIEN VALUES (30121050015, N'Huỳnh Mai Anh', N'TP. Hồ Chí Minh', 58000, 'F', '1963-05-04', 1, 30121050004, '2005-01-14');
INSERT INTO NHANVIEN VALUES (30121050027, N'Nguyễn Thúy Quỳnh Anh', N'Nam Định', 91000, 'F', '1977-04-10', 1, 30121050004, '2005-02-25');
INSERT INTO NHANVIEN VALUES (30121050035, N'Tống Thị Lan Anh', N'Vũng Tàu', 78000, 'F', '1978-10-28', 1, 30121050037, '2004-04-15');
INSERT INTO NHANVIEN VALUES (30121050037, N'Võ Việt Anh', N'Khánh Hòa', 110000, 'M', '1974-11-11', 1, NULL, '2000-05-23');
INSERT INTO NHANVIEN VALUES (30121050038, N'Vũ Thuỵ Hồng Anh', N'TP. Hồ Chí Minh', 104000, 'F', '1966-06-13', 2, 30121050142, '2000-05-24');
INSERT INTO NHANVIEN VALUES (30121050049, N'Trần Nguyễn Phương Bình', N'TP. Hồ Chí Minh', 83000, 'M', '1959-05-17', 2, 30121050038, '2005-05-12');
INSERT INTO NHANVIEN VALUES (30121050060, N'Trần Thiện Bảo', N'TP. Hồ Chí Minh', 75000, 'M', '1955-12-26', 2, 30121050038, '2008-10-20');
INSERT INTO NHANVIEN VALUES (30121050142, N'Nguyễn Hoàng Dũng', N'TP. Hồ Chí Minh', 114000, 'M', '1956-02-26', 2, NULL, '2006-12-15');
INSERT INTO NHANVIEN VALUES (30121050158, N'Lê Hoàng Linh Giang', N'Huế', 98000, 'F', '1957-07-16', 2, 30121050142, '2006-11-20');
INSERT INTO NHANVIEN VALUES (30121050180, N'Trần Ngọc Như Hằng', N'TP. Hồ Chí Minh', 59000, 'F', '1970-05-29', 5, 30121050184, '2007-01-15');
INSERT INTO NHANVIEN VALUES (30121050184, N'Nguyễn Thị Minh Hưng', N'Thanh Hóa', 92000, 'F', '1976-12-23', 5, NULL, '2007-03-18');
INSERT INTO NHANVIEN VALUES (30121050254, N'Bùi Thị Thu Hương', N'TP. Hà Nội', 117000, 'F', '1970-01-06', 3, NULL, '2008-06-24');
INSERT INTO NHANVIEN VALUES (30121050265, N'Phạm Thị Ngọc Hảo', N'Gia Lai', 35000, 'F', '1975-02-04', 3, 30121050254, '2008-08-10');
INSERT INTO NHANVIEN VALUES (30121050294, N'Trịnh Hạnh', N'TP. Đà Nẵng', 94000, 'F', '1977-02-12', 4, 30121050295, '2005-05-05');
INSERT INTO NHANVIEN VALUES (30121050295, N'Huỳnh Thị Như Hồng', N'TP. Cần Thơ', 110000, 'F', '1970-08-14', 4, NULL, '2008-12-17');
INSERT INTO NHANVIEN VALUES (30121050322, N'Đỗ Thị Thúy Hùng', N'Sông Bé', 76000, 'M', '1963-01-22', 3, 30121050254, '2002-11-11');
INSERT INTO NHANVIEN VALUES (30121050336, N'Trương Thanh Hiền', N'TP. Hải Phòng', 102000, 'F', '1963-05-16', 4, 30121050295, '2003-04-27');
INSERT INTO NHANVIEN VALUES (30121050341, N'Nguyễn Đặng Hiếu', N'TP. Hồ Chí Minh', 46000, 'F', '1970-08-30', 4, 30121050295, '2008-08-09');
INSERT INTO NHANVIEN VALUES (30121050418, N'Vũ Phạm Minh Hương', N'TP. Hà Nội', 30000, 'F', '1971-08-17', 5, 30121050184, '2009-07-25');
INSERT INTO NHANVIEN VALUES (30121050982, N'Hồ Việt Hoà', N'Đồng Nai', 95000, 'M', '1970-02-03', 3, 30121050254, '2005-11-24');

----KIỂM TRA XEM DỮ LIỆU CÓ ADD VÀO CHƯA 
SELECT * FROM NHANVIEN

--Tạo phòng ban 
CREATE TABLE PHONGBAN 
(
	MAPHG INT NOT NULL PRIMARY KEY,
	TENPHG NVARCHAR(200),
	MATRUONGPHG DECIMAL(18,0),
	NGAYBD DATE,
	--Tạo constraint lk khóa ngoại matruongphong
	CONSTRAINT PK_MATRUONGPHG FOREIGN KEY (MATRUONGPHG) REFERENCES NHANVIEN(MANV)
	-- =>Tên khóa ngoại -FOREIGN KEY ( CỘT ) CHIẾU BẢNG CHA NHANVIEN(MANV) , tạo ràng buộc khóa ngoại  
)
----INSERT phongban 

INSERT INTO PHONGBAN VALUES (1,N'Phòng Phần mềm trong nước',30121050037,'2003-01-10');
INSERT INTO PHONGBAN VALUES (2,N'Phòng Phần mềm nước ngoài',30121050142,'2005-01-06');
INSERT INTO PHONGBAN VALUES (3,N'Phòng Giải pháp mạng truyền thông',30121050254,'2000-01-01');
INSERT INTO PHONGBAN VALUES (4,N'Phòng Dịch vụ chăm sóc khách hàng',30121050295,'2008-01-07');
INSERT INTO PHONGBAN VALUES (5,N'Phòng Nghiên cứu và phát triển',30121050184,'2006-01-12');

SELECT * FROM PHONGBAN
--Tạo bảng địa điểm 
CREATE TABLE DIADIEM 
(
	MADD INT NOT NULL PRIMARY KEY,
	TENDD NVARCHAR(200)
)

----INSERT diadiem

INSERT INTO DIADIEM VALUES(1,N'TP Hà Nội');
INSERT INTO DIADIEM VALUES(2,N'TP Hải Phòng');
INSERT INTO DIADIEM VALUES(3,N'TP Đà Nẵng');
INSERT INTO DIADIEM VALUES(4,N'TP Huế');
INSERT INTO DIADIEM VALUES(5,N'TP Hồ Chí Minh');
INSERT INTO DIADIEM VALUES(6,N'TP Cần Thơ');

select * from DIADIEM



--Tạo bảng dự án 
CREATE TABLE DUAN 
(
	MADA INT NOT NULL PRIMARY KEY,
	TENDA NVARCHAR(200),
	MADD INT,
	MAPHG INT
	--Khóa ngoại là mã phòng , mã địa điểm 
	CONSTRAINT PK_MADD FOREIGN KEY (MADD) REFERENCES DIADIEM(MADD),
	CONSTRAINT PK_MAPHG FOREIGN KEY(MAPHG) REFERENCES PHONGBAN(MAPHG)
)

----INSERT DUAN 
INSERT INTO DUAN VALUES (1,'ProjectA',1,3);
INSERT INTO DUAN VALUES (2,'ProjectB',1,2);
INSERT INTO DUAN VALUES (3,'ProjectC',3,2);
INSERT INTO DUAN VALUES (4,'ProjectD',2,1);
INSERT INTO DUAN VALUES (5,'ProjectE',5,4);

SELECT * FROM DUAN

--Tạo bảng phân công 
CREATE TABLE PHANCONG 
(
	-- MANV DECIMAL(18,0) NOT NIULL PRIMARY KEY,
	-- KO THỂ KHAI BÁO 2 THUỘC TÍNH PRIMARY KEY 
	MANV DECIMAL(18,0) NOT NULL,
	MADA INT NOT NULL,
	SOGIO INT,
	--TRƯỜNG HỢP TỪ 2 PRIMARY KEY TRỞ LÊN DÙNG CONSTRAINT 
	CONSTRAINT PR_MANV_MADA PRIMARY KEY (MANV,MADA),
	--KHÓA NGOẠI 
	CONSTRAINT PK_MANV2 FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
	CONSTRAINT PK_MADA2 FOREIGN KEY(MADA) REFERENCES DUAN(MADA)


)

CREATE TABLE NGUOIPHUTHUOC
(
	TENNPT nvarchar(200) NOT NULL,
	MANV DECIMAL(18,0) NOT NULL,
	GIOITINH CHAR(5),
	NGAYSINH DATE,
	TENMQH NVARCHAR(200),
	CONSTRAINT PR_TENNPT_MANV PRIMARY KEY(TENNPT,MANV),
	CONSTRAINT PK_MANV3 FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV) 
)

INSERT INTO NGUOIPHUTHUOC VALUES (N'Vương Thị Kim Cúc', 30121050004, 'F', '1978-03-20', N'Em');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Phạm Nguyên Dũng', 30121050015, 'M', '1965-04-16', N'Chồng');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Nguyễn Thị Thùy Dung', 30121050027, 'F', '1953-10-01', N'Mẹ');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Phan Thành Đăng', 30121050035, 'M', '1970-02-24', N'Chồng');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Hà Mỹ Duyên', 30121050037, 'F', '1980-06-15', N'Vợ');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Đoàn Minh Đạo', 30121050038, 'M', '1962-10-04', N'Chồng');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Huỳnh Thị Ngọc Điệp', 30121050049, 'F', '1970-06-13', N'Vợ');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Nguyễn Thị Minh Hằng', 30121050060, 'F', '1965-01-04', N'Vợ');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Nguyễn Thị Thu Hằng', 30121050142, 'F', '1969-03-30', N'Vợ');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Hồ Đức Trung Hữu', 30121050158, 'M', '1960-04-16', N'Chồng');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Bùi Phương Ngọc', 30121050180, 'M', '1967-03-30', N'Chồng');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Nguyễn Thị Minh Hà', 30121050184, 'F', '1980-03-06', N'Em');
INSERT INTO NGUOIPHUTHUOC VALUES (N'Nguyễn Thạc Hải', 30121050254, 'M', '1970-09-17', N'Chồng');

SELECT * FROM NGUOIPHUTHUOC

CREATE TABLE PHANCONGDD 
(
	MAPHG INT NOT NULL,
	MADD INT NOT NULL,
	CONSTRAINT PR_MAPHG_MADD PRIMARY KEY(MAPHG,MADD),
	CONSTRAINT PK_MAPHG3 FOREIGN KEY(MAPHG) REFERENCES PHONGBAN(MAPHG),
	CONSTRAINT PK_MADD3 FOREIGN KEY(MADD) REFERENCES DIADIEM(MADD)

)


